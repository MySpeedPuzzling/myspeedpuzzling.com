{"version":3,"file":"Trigger.js","names":["throwIfMissing","BoundingBox","Trigger","options","_show","bind","_hide","_handleEntry","_handleMovement","el","zoomPane","sourceAttribute","handleTouch","onShow","onHide","hoverDelay","touchDelay","hoverBoundingBox","touchBoundingBox","namespace","zoomFactor","boundingBoxContainer","passive","settings","boundingBox","containerEl","enabled","_bindEvents","event","preventDefault","_isTouchEvent","isShowing","touches","addEventListener","isPassive","_preventDefault","removeEventListener","e","_preventDefaultAllowTouchScroll","_lastMovement","type","entryTimeout","setTimeout","show","getAttribute","clientWidth","clientHeight","touchActivated","clearTimeout","hide","movementX","movementY","firstTouch","clientX","clientY","rect","getBoundingClientRect","offsetX","left","offsetY","top","percentageOffsetX","percentageOffsetY","setPosition"],"sources":["../src/js/Trigger.js"],"sourcesContent":["import throwIfMissing from \"./util/throwIfMissing\";\nimport BoundingBox from \"./BoundingBox\";\n\nexport default class Trigger {\n  constructor(options = {}) {\n    this._show = this._show.bind(this);\n    this._hide = this._hide.bind(this);\n    this._handleEntry = this._handleEntry.bind(this);\n    this._handleMovement = this._handleMovement.bind(this);\n\n    const {\n      el = throwIfMissing(),\n      zoomPane = throwIfMissing(),\n      sourceAttribute = throwIfMissing(),\n      handleTouch = throwIfMissing(),\n      onShow = null,\n      onHide = null,\n      hoverDelay = 0,\n      touchDelay = 0,\n      hoverBoundingBox = throwIfMissing(),\n      touchBoundingBox = throwIfMissing(),\n      namespace = null,\n      zoomFactor = throwIfMissing(),\n      boundingBoxContainer = throwIfMissing(),\n      passive = false,\n    } = options;\n\n    this.settings = {\n      el,\n      zoomPane,\n      sourceAttribute,\n      handleTouch,\n      onShow,\n      onHide,\n      hoverDelay,\n      touchDelay,\n      hoverBoundingBox,\n      touchBoundingBox,\n      namespace,\n      zoomFactor,\n      boundingBoxContainer,\n      passive,\n    };\n\n    if (this.settings.hoverBoundingBox || this.settings.touchBoundingBox) {\n      this.boundingBox = new BoundingBox({\n        namespace: this.settings.namespace,\n        zoomFactor: this.settings.zoomFactor,\n        containerEl: this.settings.boundingBoxContainer,\n      });\n    }\n\n    this.enabled = true;\n\n    this._bindEvents();\n  }\n\n  get isShowing() {\n    return this.settings.zoomPane.isShowing;\n  }\n\n  _preventDefault(event) {\n    event.preventDefault();\n  }\n\n  _preventDefaultAllowTouchScroll(event) {\n    if (!this.settings.touchDelay || !this._isTouchEvent(event) || this.isShowing) {\n      event.preventDefault();\n    }\n  }\n\n  _isTouchEvent(event) {\n    return !!event.touches;\n  }\n\n  _bindEvents() {\n    this.settings.el.addEventListener(\"mouseenter\", this._handleEntry);\n    this.settings.el.addEventListener(\"mouseleave\", this._hide);\n    this.settings.el.addEventListener(\"mousemove\", this._handleMovement);\n\n    const isPassive = { passive: this.settings.passive };\n    if (this.settings.handleTouch) {\n      this.settings.el.addEventListener(\"touchstart\", this._handleEntry, isPassive);\n      this.settings.el.addEventListener(\"touchend\", this._hide);\n      this.settings.el.addEventListener(\"touchmove\", this._handleMovement, isPassive);\n    } else {\n      this.settings.el.addEventListener(\"touchstart\", this._preventDefault, isPassive);\n      this.settings.el.addEventListener(\"touchend\", this._preventDefault);\n      this.settings.el.addEventListener(\"touchmove\", this._preventDefault, isPassive);\n    }\n  }\n\n  _unbindEvents() {\n    this.settings.el.removeEventListener(\"mouseenter\", this._handleEntry);\n    this.settings.el.removeEventListener(\"mouseleave\", this._hide);\n    this.settings.el.removeEventListener(\"mousemove\", this._handleMovement);\n\n    if (this.settings.handleTouch) {\n      this.settings.el.removeEventListener(\"touchstart\", this._handleEntry);\n      this.settings.el.removeEventListener(\"touchend\", this._hide);\n      this.settings.el.removeEventListener(\"touchmove\", this._handleMovement);\n    } else {\n      this.settings.el.removeEventListener(\"touchstart\", this._preventDefault);\n      this.settings.el.removeEventListener(\"touchend\", this._preventDefault);\n      this.settings.el.removeEventListener(\"touchmove\", this._preventDefault);\n    }\n  }\n\n  _handleEntry(e) {\n    this._preventDefaultAllowTouchScroll(e);\n    this._lastMovement = e;\n\n    if (e.type == \"mouseenter\" && this.settings.hoverDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.hoverDelay);\n    } else if (this.settings.touchDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.touchDelay);\n    } else {\n      this._show();\n    }\n  }\n\n  _show() {\n    if (!this.enabled) {\n      return;\n    }\n\n    const onShow = this.settings.onShow;\n    if (onShow && typeof onShow === \"function\") {\n      onShow();\n    }\n\n    this.settings.zoomPane.show(\n      this.settings.el.getAttribute(this.settings.sourceAttribute),\n      this.settings.el.clientWidth,\n      this.settings.el.clientHeight\n    );\n\n    if (this._lastMovement) {\n      const touchActivated = this._lastMovement.touches;\n      if ((touchActivated && this.settings.touchBoundingBox) || (!touchActivated && this.settings.hoverBoundingBox)) {\n        this.boundingBox.show(this.settings.zoomPane.el.clientWidth, this.settings.zoomPane.el.clientHeight);\n      }\n    }\n\n    this._handleMovement();\n  }\n\n  _hide(e) {\n    if (e) {\n      this._preventDefaultAllowTouchScroll(e);\n    }\n\n    this._lastMovement = null;\n\n    if (this.entryTimeout) {\n      clearTimeout(this.entryTimeout);\n    }\n\n    if (this.boundingBox) {\n      this.boundingBox.hide();\n    }\n\n    const onHide = this.settings.onHide;\n    if (onHide && typeof onHide === \"function\") {\n      onHide();\n    }\n\n    this.settings.zoomPane.hide();\n  }\n\n  _handleMovement(e) {\n    if (e) {\n      this._preventDefaultAllowTouchScroll(e);\n      this._lastMovement = e;\n    } else if (this._lastMovement) {\n      e = this._lastMovement;\n    } else {\n      return;\n    }\n\n    let movementX;\n    let movementY;\n\n    if (e.touches) {\n      const firstTouch = e.touches[0];\n      movementX = firstTouch.clientX;\n      movementY = firstTouch.clientY;\n    } else {\n      movementX = e.clientX;\n      movementY = e.clientY;\n    }\n\n    const el = this.settings.el;\n    const rect = el.getBoundingClientRect();\n    const offsetX = movementX - rect.left;\n    const offsetY = movementY - rect.top;\n\n    const percentageOffsetX = offsetX / this.settings.el.clientWidth;\n    const percentageOffsetY = offsetY / this.settings.el.clientHeight;\n\n    if (this.boundingBox) {\n      this.boundingBox.setPosition(percentageOffsetX, percentageOffsetY, rect);\n    }\n\n    this.settings.zoomPane.setPosition(percentageOffsetX, percentageOffsetY, rect);\n  }\n}\n"],"mappings":"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"}