{#
    Stream for removing puzzle from collection (from list context).

    Parameters:
    - puzzle_id: The puzzle ID being removed
    - removed_from_collection_id: Collection ID the puzzle was removed from
    - current_collection_id: Collection ID currently being viewed
    - remaining_count: Remaining items in collection
    - message: Toast message
    - puzzle_statuses: For dropdown update
    - context: Current context
    - source_collection_id: For dropdown

    For cross-collection removal (removing from different collection than currently viewed):
    - item: CollectionItemOverview - the item in the current collection for card replacement
    - logged_user: Current logged user
    - collection_id: Current collection ID
#}

{{ include('_modal_close_stream.html.twig') }}

{% if removed_from_collection_id == current_collection_id %}
    {# Removing from the same collection we're viewing - remove the item #}
    {{ include('_library_item_stream.html.twig', {
        action: 'remove',
        page_context: 'collection',
        puzzle_id: puzzle_id,
    }) }}

    {# Update the count #}
    <turbo-stream action="update" target="collection-count">
        <template>{{ remaining_count }}</template>
    </turbo-stream>

    {# Show empty state if no items remaining #}
    {% if remaining_count == 0 %}
    <turbo-stream action="update" target="collection-list-container">
        <template>
            {{ include('collections/_empty_state.html.twig') }}
        </template>
    </turbo-stream>
    {% endif %}
{% elseif item is defined %}
    {# Removing from a different collection - replace card to update dropdown #}
    {% set coll_id = collection_id|default('__system_collection__') %}
    {{ include('_library_item_stream.html.twig', {
        action: 'replace',
        page_context: 'collection',
        item: item,
        puzzle_statuses: puzzle_statuses,
        logged_user: logged_user,
        isOwnProfile: true,
        source_collection_id: coll_id,
        currentCollectionId: coll_id,
    }) }}
{% endif %}

{{ include('_toast_stream.html.twig', {message: message}) }}
