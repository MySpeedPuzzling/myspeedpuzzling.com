{% extends 'base.html.twig' %}

{% block title %}{{ 'collections.add_puzzle_form.title'|trans }}{% endblock %}

{% block content %}
    <twig:PlayerHeader player="{{ player }}" />

    <div class="mb-4">
        <h2>{{ 'collections.add_puzzle_form.title'|trans }}</h2>
        <p class="text-muted">{{ 'collections.add_puzzle_form.description'|trans }}</p>
    </div>

    <div data-controller="add-puzzle-to-collection-form" data-add-puzzle-to-collection-form-system-id-value="{{ system_collection_id }}">
        {{ form_start(form, { 'attr': { 'data-controller': 'submit-prevention' } }) }}
            {{ form_errors(form) }}

            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="card shadow-lg">
                        <div class="card-header">
                            <h5 class="mb-0">{{ 'collections.add_puzzle_form.puzzle_section'|trans }}</h5>
                        </div>
                        <div class="card-body">
                            {{ form_row(form.brand, {'attr': {'data-add-puzzle-to-collection-form-target': 'brand'}}) }}

                            {{ form_row(form.puzzle, {'attr': {'data-add-puzzle-to-collection-form-target': 'puzzle'}}) }}

                            <div data-add-puzzle-to-collection-form-target="newPuzzle" class="{{ hide_new_puzzle|default(true) ? 'd-none' }}">
                                <div class="border rounded p-3 bg-light mt-3">
                                    <h6 class="mb-3">{{ 'collections.add_puzzle_form.new_puzzle_section'|trans }}</h6>
                                    <p>
                                        <small class="text-muted">{{ 'add_time.need_approve_info'|trans }}</small>
                                    </p>

                                    {{ form_row(form.puzzlePiecesCount) }}

                                    {{ form_row(form.puzzleEan) }}
                                    {{ form_row(form.puzzleIdentificationNumber) }}

                                    {{ form_label(form.puzzlePhoto) }}
                                    {{ form_errors(form.puzzlePhoto) }}

                                    <div class="form-text mb-1 help-text">{{ 'forms.puzzle_photo_help'|trans }}</div>
                                    <div class="file-drop-area">
                                        <div class="file-drop-icon ci-cloud-upload"></div>
                                        <span class="file-drop-message">{{ 'forms.drop_file'|trans }}</span>
                                        {{ form_widget(form.puzzlePhoto, {'attr': {'class': 'file-drop-input'}}) }}
                                        <button type="button" class="file-drop-btn btn btn-outline-primary btn-sm">{{ 'forms.choose_file'|trans }}</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6 mb-4">
                    <div class="card shadow-lg">
                        <div class="card-header">
                            <h5 class="mb-0">{{ 'collections.add_puzzle_form.collection_section'|trans }}</h5>
                        </div>
                        <div class="card-body">
                            {% if not has_active_membership %}
                                <div class="mb-3">
                                    <label class="form-label">{{ 'forms.add_puzzle_to_collection.collection'|trans }}</label>
                                    <div class="input-group">
                                        <input
                                            type="text"
                                            class="form-control"
                                            value="{{ 'collections.system_name'|trans }}"
                                            disabled
                                            readonly
                                        >
                                        <span class="input-group-text bg-light">
                                            <i class="ci-locked"></i>
                                        </span>
                                    </div>
                                    <small class="form-text text-muted">
                                        {{ 'collections.membership_required.help_text'|trans }}
                                        <button
                                            type="button"
                                            class="btn btn-link btn-sm p-0 align-baseline"
                                            data-bs-toggle="modal"
                                            data-bs-target="#membersExclusiveModal"
                                        >
                                            <i class="ci-locked"></i> {{ 'collections.membership_required.unlock_link'|trans }}
                                        </button>
                                    </small>
                                </div>
                                {{ form_row(form.collection, {
                                    'row_attr': {
                                        'class': 'd-none'
                                    },
                                    'attr': {
                                        'data-add-puzzle-to-collection-form-target': 'collection'
                                    }
                                }) }}
                            {% else %}
                                {{ form_row(form.collection, {
                                    'attr': {
                                        'data-add-puzzle-to-collection-form-target': 'collection'
                                    }
                                }) }}
                            {% endif %}

                            <div class="mb-3 d-none" data-add-puzzle-to-collection-form-target="newCollection">
                                <div class="border rounded p-3 bg-light">
                                    <h6 class="mb-3">{{ 'collections.create.title'|trans }}</h6>

                                    {{ form_row(form.collectionVisibility) }}

                                    {{ form_row(form.collectionDescription) }}
                                </div>
                            </div>

                            {{ form_row(form.comment, {
                                'attr': {
                                    'rows': 3,
                                    'maxlength': 500,
                                    'placeholder': 'forms.add_puzzle_to_collection.comment_placeholder',
                                }
                            }) }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between">
                <a href="{{ cancel_url }}" class="btn btn-secondary">
                    {{ 'forms.cancel'|trans }}
                </a>
                <button type="submit" name="submit" class="btn btn-primary" data-submit-prevention-target="submit">
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    {{ 'collections.add_puzzle_form.submit'|trans }}
                </button>
            </div>

        {{ form_end(form) }}
    </div>
{% endblock %}
