<div {{ attributes }}>
    <h3 class="h4 mt-5 mb-0">{{ 'hub.most_solved_puzzle'|trans }}</h3>

    <ul class="nav nav-fill nav-tabs mt-0" role="tablist">
        <li class="nav-item">
            <a class="nav-link {{ this.timespan == 'this_month' ? 'active' }}"
               href="#"
               data-action="live#action"
               data-live-action-param="changeTimespan"
               data-live-timespan-param="this_month"
            >
                <div class="text-center">
                    <h6 class="media-tab-title text-nowrap pt-2 mb-0">{{ 'hub.this_month'|trans|raw }}</h6>
                </div>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link {{ this.timespan == 'last_month' ? 'active' }}"
               href="#"
               data-action="live#action"
               data-live-action-param="changeTimespan"
               data-live-timespan-param="last_month"
            >
                <div class="text-center">
                    <h6 class="media-tab-title text-nowrap pt-2 mb-0">{{ 'hub.last_month'|trans|raw }}</h6>
                </div>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link {{ this.timespan == 'all_time' ? 'active' }}"
               href="#"
               data-action="live#action"
               data-live-action-param="changeTimespan"
               data-live-timespan-param="all_time"
            >
                <div class="text-center">
                    <h6 class="media-tab-title text-nowrap pt-2 mb-0">{{ 'hub.all_time'|trans|raw }}</h6>
                </div>
            </a>
        </li>
    </ul>

    <div data-controller="show-more-recent-activity">
        <div class="table-responsive custom-table-wrapper">
            <table class="table table-striped table-hover mb-0">
                <tbody>
                    {% set ranking = this.ranking %}
                    {% for most_solved_puzzle in this.puzzles %}
                        <tr class="{{ this.showLimit > 0 and loop.index > this.showLimit ? 'd-none' }}">
                            <td class="text-center">
                                <a href="{{ path('puzzle_detail', {puzzleId: most_solved_puzzle.puzzleId}) }}">
                                    {{ lazy_puzzle_image(
                                        most_solved_puzzle.puzzleImage,
                                        'puzzle_small',
                                        'puzzle_img_alt'|trans({'%puzzle%': most_solved_puzzle.manufacturerName ~ ' ' ~ most_solved_puzzle.puzzleName}),
                                        loop.index,
                                        80,
                                        'rounded-2'
                                    ) }}
                                </a>
                            </td>

                            <td class="d-none d-sm-table-cell">
                                <a class="d-inline-block" style="line-height: 120%" href="{{ path('puzzle_detail', {puzzleId: most_solved_puzzle.puzzleId}) }}">
                                        <span style="color: #111;">
                                            {{ most_solved_puzzle.manufacturerName }}<br>
                                            <small>{{ 'pieces_count'|trans({ '%count%': most_solved_puzzle.piecesCount })|raw }}</small>
                                        </span><br>

                                    <small class="puzzle-title mt-2">
                                        {{ most_solved_puzzle.puzzleName }}
                                    </small>
                                </a>
                            </td>

                            <td>
                                <small style="color: #000;">{{ 'puzzle_solved_times'|trans({'%count%': most_solved_puzzle.solvedTimes})|capitalize|raw }}</small><br>

                                <p class="mt-0 mb-1 d-sm-none low-line-height">
                                    <a href="{{ path('puzzle_detail', {puzzleId: most_solved_puzzle.puzzleId}) }}">
                                        <small>{{ most_solved_puzzle.manufacturerName }}</small><br>
                                        <small>{{ 'pieces_count'|trans({ '%count%': most_solved_puzzle.piecesCount })|raw }}</small>
                                    </a>
                                </p>
                            </td>
                            <td class="text-end">
                                <small class="low-line-height d-inline-block">{{ 'fastest_time_short'|trans({ '%time%': most_solved_puzzle.fastestTimeSolo|puzzlingTime }) }}</small>

                                {% if logged_user.profile is not null %}
                                    {% if ranking[most_solved_puzzle.puzzleId] is defined %}
                                        <br>
                                        <small class="mt-1 low-line-height d-inline-block">{{ 'my_time'|trans }} {{ ranking[most_solved_puzzle.puzzleId].time|puzzlingTime }}</small>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if this.showLimit > 0 and this.puzzles|length > this.showLimit %}
            <button class="mt-3 btn btn-outline-primary btn-sm" data-action="click->show-more-recent-activity#revealRows" data-show-more-recent-activity-target="button">{{ 'show_more'|trans }}</button>
        {% endif %}
    </div>
</div>

{% macro placeholder(props) %}
    <div>
        <h3 class="h4 mt-5 mb-0">{{ 'hub.most_solved_puzzle'|trans }}</h3>

        <ul class="nav nav-fill nav-tabs mt-0" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" href="#">
                    <div class="text-center">
                        <h6 class="media-tab-title text-nowrap pt-2 mb-0">{{ 'hub.this_month'|trans|raw }}</h6>
                    </div>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <div class="text-center">
                        <h6 class="media-tab-title text-nowrap pt-2 mb-0">{{ 'hub.last_month'|trans|raw }}</h6>
                    </div>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <div class="text-center">
                        <h6 class="media-tab-title text-nowrap pt-2 mb-0">{{ 'hub.all_time'|trans|raw }}</h6>
                    </div>
                </a>
            </li>
        </ul>

        <div class="table-responsive custom-table-wrapper">
            <table class="table table-striped table-hover mb-0 placeholder-glow">
                <tbody>
                    {% set rowCount = props.showLimit > 0 ? props.showLimit : props.limit|default(4) %}
                    {% for i in 1..rowCount %}
                        <tr>
                            <td class="text-center">
                                <span class="rounded-2 d-inline-block" style="width: 80px; height: 58px; background: #e9ecef;"></span>
                            </td>
                            <td class="d-none d-sm-table-cell">
                                <span class="d-inline-block" style="line-height: 120%;">
                                    <span style="color: #111;">
                                        <span class="placeholder" style="width: 85px;"></span><br>
                                        <small><span class="placeholder placeholder-sm" style="width: 55px;"></span></small>
                                    </span><br>
                                    <small class="puzzle-title mt-2"><span class="placeholder placeholder-sm" style="width: 110px;"></span></small>
                                </span>
                            </td>
                            <td>
                                <small><span class="placeholder" style="width: 75px;"></span></small><br>
                                <p class="mt-0 mb-1 d-sm-none low-line-height">
                                    <small><span class="placeholder placeholder-sm" style="width: 65px;"></span></small><br>
                                    <small><span class="placeholder placeholder-sm" style="width: 45px;"></span></small>
                                </p>
                            </td>
                            <td class="text-end">
                                <small class="low-line-height d-inline-block">
                                    <span class="placeholder placeholder-sm" style="width: 70px;"></span>
                                </small>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if props.showLimit > 0 %}
            <button class="mt-3 btn btn-outline-primary btn-sm disabled" style="width: 100px;">
                <span class="spinner-border spinner-border-sm"></span>
            </button>
        {% endif %}
    </div>
{% endmacro %}
