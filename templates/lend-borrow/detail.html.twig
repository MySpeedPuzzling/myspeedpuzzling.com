{% extends 'base.html.twig' %}

{% block title %}{{ 'lend_borrow.title'|trans }}{% if not isOwnProfile %} - {{ player.playerName }}{% endif %}{% endblock %}

{% block content %}
<div data-controller="collection-items">
    <twig:PlayerHeader player="{{ player }}" />

    {% include '_return_back_button.html.twig' with {fallbackUrl: path('puzzle_library', {playerId: player.playerId}), fallbackTitle: 'collections.back_to_library'|trans} %}

    <div class="d-flex flex-column flex-sm-row align-items-start justify-content-between gap-2 mb-4">
        <div>
            <h1 class="h3 mb-0 d-flex align-items-center">
                <span><i class="bi bi-box-arrow-right me-2"></i>{{ 'lend_borrow.title'|trans }}</span>
                {% if isOwnProfile and hasMembership %}
                    <a href="{{ path('edit_lend_borrow_list_settings', {playerId: player.playerId, 'return': path('lend_borrow_list_detail', {playerId: player.playerId}), 'return_title': 'lend_borrow.title'|trans}) }}" data-turbo="true" data-turbo-frame="modal-frame" class="fs-sm fw-normal {{ visibility.value == 'public' ? 'text-primary' : 'text-muted' }} ms-2 me-2 text-decoration-underline">
                        <i class="bi bi-{{ visibility.value == 'public' ? 'eye' : 'lock' }} me-1"></i>{{ visibility.value == 'public' ? 'collections.public'|trans : 'collections.private'|trans }}
                    </a>
                    {% if visibility.value != 'public' %}
                        <small class="text-muted fs-xs">{{ 'collections.change_to_public_hint'|trans }}</small>
                    {% endif %}
                {% elseif isOwnProfile %}
                    <small class="fs-sm fw-normal {{ visibility.value == 'public' ? 'text-primary' : 'text-muted' }} ms-2 me-2">
                        <i class="bi bi-{{ visibility.value == 'public' ? 'eye' : 'lock' }} me-1"></i>{{ visibility.value == 'public' ? 'collections.public'|trans : 'collections.private'|trans }}
                    </small>
                    {% if visibility.value != 'public' %}
                        <small class="text-muted fs-xs">{{ 'collections.change_to_public_hint'|trans }}</small>
                    {% endif %}
                {% endif %}
            </h1>
        </div>

        <div class="d-flex align-items-center gap-2 flex-shrink-0">
            {% if isOwnProfile and visibility.value == 'public' %}
                {{ include('_share_button.html.twig', {share_url: url('lend_borrow_list_detail', {playerId: player.playerId})}) }}
            {% endif %}
            {% if isOwnProfile and hasMembership %}
                <a href="{{ path('edit_lend_borrow_list_settings', {playerId: player.playerId, 'return': path('lend_borrow_list_detail', {playerId: player.playerId}), 'return_title': 'lend_borrow.title'|trans}) }}" data-turbo="true" data-turbo-frame="modal-frame" class="btn btn-sm btn-outline-primary">
                    <i class="ci-edit me-1"></i> {{ 'edit'|trans }}
                </a>
            {% endif %}
        </div>
    </div>

    {# Tabs for Lent and Borrowed #}
    <div class="btn-group w-100 mb-4" role="tablist">
        <button type="button" class="btn btn-outline-primary py-2 px-3 d-flex flex-column align-items-center lh-sm active"
                id="lent-tab" data-bs-toggle="tab" data-bs-target="#lent-pane" role="tab" aria-controls="lent-pane" aria-selected="true">
            <i class="bi bi-box-arrow-up-right"></i>
            <small>{{ 'lend_borrow.tab.lent'|trans }} (<span id="lent-tab-count">{{ lentPuzzles|length }}</span>)</small>
        </button>

        <button type="button" class="btn btn-outline-primary py-2 px-3 d-flex flex-column align-items-center lh-sm"
                id="borrowed-tab" data-bs-toggle="tab" data-bs-target="#borrowed-pane" role="tab" aria-controls="borrowed-pane" aria-selected="false">
            <i class="bi bi-box-arrow-in-down-left"></i>
            <small>{{ 'lend_borrow.tab.borrowed'|trans }} (<span id="borrowed-tab-count">{{ borrowedPuzzles|length }}</span>)</small>
        </button>
    </div>

    <div class="tab-content">
        {# Lent Puzzles Tab #}
        <div class="tab-pane fade show active" id="lent-pane" role="tabpanel" aria-labelledby="lent-tab">
            <div id="lent-list-container">
            {% if lentPuzzles is empty %}
                {{ include('lend-borrow/_lent_empty_state.html.twig', {isOwnProfile: isOwnProfile, player: player}) }}
            {% else %}
                <div class="row g-3 mb-3">
                    {% for item in lentPuzzles %}
                        {{ include('_puzzle_library_item.html.twig', {
                            item: item,
                            page_context: 'lend-borrow-lent',
                            puzzle_statuses: puzzle_statuses,
                            logged_user: logged_user,
                            isOwnProfile: isOwnProfile,
                        }) }}
                    {% endfor %}
                </div>
            {% endif %}
            </div>
        </div>

        {# Borrowed Puzzles Tab #}
        <div class="tab-pane fade" id="borrowed-pane" role="tabpanel" aria-labelledby="borrowed-tab">
            <div id="borrowed-list-container">
            {% if borrowedPuzzles is empty %}
                {{ include('lend-borrow/_borrowed_empty_state.html.twig', {isOwnProfile: isOwnProfile, player: player}) }}
            {% else %}
                <div class="row g-3 mb-3">
                    {% for item in borrowedPuzzles %}
                        {{ include('_puzzle_library_item.html.twig', {
                            item: item,
                            page_context: 'lend-borrow-borrowed',
                            puzzle_statuses: puzzle_statuses,
                            logged_user: logged_user,
                            isOwnProfile: isOwnProfile,
                        }) }}
                    {% endfor %}
                </div>
            {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
