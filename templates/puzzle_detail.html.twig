{% extends 'base.html.twig' %}

{% block title %}{{ puzzle.puzzleName }}{% endblock %}

{% block content %}
    <h1>
        {% if app.request.locale is same as 'cs' and puzzle.puzzleAlternativeName is not null %}
            {{ puzzle.puzzleAlternativeName }}
            <span class="h4">({{ puzzle.puzzleName }})</span>
        {% else %}
            {{ puzzle.puzzleName }}
        {% endif %}
    </h1>

    <div class="row">
        <div class="col-sm-12 col-md-6">
            <p>
                {% for tag in tags %}
                    <span class="badge bg-primary badge-shadow rounded-pill"><i class="ci-diamond"></i> {{ tag.name }}</span>
                {% endfor %}

                {% if app.request.locale is same as 'cs' %}
                    {% if puzzle.isAvailable %}
                        <span class="badge bg-success badge-shadow rounded-pill">{{ 'puzzle_available'|trans }}</span>
                    {% else %}
                        <span class="badge bg-dark badge-shadow rounded-pill">{{ 'puzzle_not_available'|trans }}</span>
                    {% endif %}
                {% endif %}

                {% if puzzle.puzzleId in puzzles_solved_by_user %}
                    <span class="badge bg-success badge-shadow rounded-pill"><i class="ci-check"></i> {{ 'puzzle_solved'|trans }}</span>
                {% endif %}
            </p>

            <p>
                <a href="{{ path('stopwatch_puzzle', {puzzleId: puzzle.puzzleId}) }}" class="btn btn-accent btn-sm mb-1 me-1">
                    <i class="ci-time"></i> {{ 'start_solving'|trans }}
                </a>
                <a href="{{ path('add_time', {puzzleId: puzzle.puzzleId}) }}" class="btn btn-accent mb-1 btn-sm">
                    <i class="ci-add"></i> {{ 'add_my_time'|trans }}
                </a>
            </p>

            <p class="card-text fs-sm text-muted mb-2">
                <b class="h5">{{ puzzle.manufacturerName|upper }}</b> <span class="text-muted">{{ puzzle.puzzleIdentificationNumber }}</span><br>
                {{ 'pieces_count'|trans({ '%count%': puzzle.piecesCount })|raw }}
                <br>

                {% if puzzle.solvedTimes > 0 %}
                    {{ 'fastest_time'|trans({ '%time%': puzzle.fastestTime|puzzlingTime }) }}<br>
                    {{ 'average_time'|trans({ '%time%': puzzle.averageTime|puzzlingTime }) }}<br>
                    {% if ranking[puzzle.puzzleId] is defined %}
                        <strong>
                            {{ 'my_time'|trans({ '%time%': ranking[puzzle.puzzleId].time|puzzlingTime }) }}
                        </strong>
                        <br>
                    {% endif %}
                    {{ 'puzzle_solved_count'|trans({ '%count%': puzzle.solvedTimes }) }}
                {% endif %}
            </p>
        </div>

        <div class="col-sm-12 col-md-6">
            {% if puzzle.puzzleImage is not null%}
                <div class="gallery">
                    <a class="gallery-item gallery-item-inline-block rounded-2" href="{{ uploaded_asset(puzzle.puzzleImage) }}">
                        <img style="max-width: 200px;max-height: 200px;" src="{{ puzzle.puzzleImage|imagine_filter('puzzle_medium') }}">
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist" {{ stimulus_controller('tabs') }}>
        <li class="nav-item">
            <a class="nav-link active" href="#solo" data-bs-toggle="tab" role="tab" {{ stimulus_action('tabs', 'showTab') }}>
                <div class="text-center">
                    <div class="media-tab-media"><i class="ci-user"></i></div>
                    <h6 class="media-tab-title text-nowrap pt-2 mb-0">Solo</h6>
                </div>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="#pairs" data-bs-toggle="tab" role="tab" {{ stimulus_action('tabs', 'showTab') }}>
                <div class="text-center">
                    <div class="media-tab-media media-tab-media-pairs">
                        <i class="ci-user"></i>
                        <i class="ci-user"></i>
                    </div>
                    <h6 class="media-tab-title text-nowrap pt-2 mb-0">Pairs</h6>
                </div>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="#groups" data-bs-toggle="tab" role="tab" {{ stimulus_action('tabs', 'showTab') }}>
                <div class="text-center">
                    <div class="media-tab-media media-tab-media-groups">
                        <i class="ci-user"></i>
                        <i class="ci-user"></i>
                        <div>
                            <i class="ci-user"></i>
                            <i class="ci-user"></i>
                        </div>
                    </div>
                    <h6 class="media-tab-title text-nowrap pt-2 mb-0">Groups</h6>
                </div>
            </a>
        </li>

    </ul>

    <!-- Tabs content -->
    <div class="tab-content">
        <div class="tab-pane fade show active" id="solo" role="tabpanel">
            <p class="fs-sm">Raw denim you probably haven't heard of them jean shorts Austin. Nesciunt tofu stumptown aliqua, retro synth master cleanse. Mustache cliche tempor, williamsburg carles vegan helvetica. Reprehenderit butcher retro keffiyeh dreamcatcher synth. Cosby sweater eu banh mi, qui irure terry richardson ex squid. Aliquip placeat salvia cillum iphone. Seitan aliquip quis cardigan american apparel, butcher voluptate nisi qui. Excepteur sint occaecat cupidatat non proident.</p>
        </div>
        <div class="tab-pane fade" id="pairs" role="tabpanel">
            <p class="fs-sm">Food truck fixie locavore, accusamus mcsweeney's marfa nulla single-origin coffee squid. Exercitation +1 labore velit, blog sartorial PBR leggings next level wes anderson artisan four loko farm-to-table craft beer twee. Qui photo booth letterpress, commodo enim craft beer mlkshk aliquip jean shorts ullamco ad vinyl cillum PBR. Homo nostrud organic, assumenda labore aesthetic magna delectus mollit. Keytar helvetica VHS salvia yr, vero magna velit sapiente.</p>
        </div>
        <div class="tab-pane fade" id="groups" role="tabpanel">
            <p class="fs-sm">Food truck fixie locavore, accusamus mcsweeney's marfa nulla single-origin coffee squid. Exercitation +1 labore velit, blog sartorial PBR leggings next level wes anderson artisan four loko farm-to-table craft beer twee. Qui photo booth letterpress, commodo enim craft beer mlkshk aliquip jean shorts ullamco ad vinyl cillum PBR. Homo nostrud organic, assumenda labore aesthetic magna delectus mollit. Keytar helvetica VHS salvia yr, vero magna velit sapiente.</p>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-sm-12 col-md-6">
            <h2 class="h4">{{ 'ladder.solo'|trans }}</h2>

            <div class="table-responsive custom-table-wrapper mt-2 mb-5">
                <table class="table custom-table table-striped table-hover mb-0">
                    <thead>
                    <tr>
                        <th></th>
                        <th>{{ 'puzzler_name'|trans }}</th>
                        <th class="text-end">{{ 'time'|trans }}</th>
                    </tr>
                    </thead>
                    <tbody>
                        {% for player_id, grouped_solver in solo_puzzle_solvers %}
                            <tr class="{{ logged_user.profile is not null and player_id is same as logged_user.profile.playerId ? 'table-active-player' }}">
                                <td class="rank">{{ loop.index }}.</td>
                                <td class="player-name text-nowrap">
                                    <a href="{{ path('player_profile', {playerId: player_id}) }}">
                                        {% if logged_user.profile is not null and grouped_solver[0].playerId in logged_user.profile.favoritePlayers %}
                                            <i class="ci-star-filled text-warning"></i>
                                        {% endif %}
                                        {{ grouped_solver[0].playerName }}</a>
                                    {% if grouped_solver[0].playerCountry is not null %}
                                        <small class="shadow-custom fi fi-{{ grouped_solver[0].playerCountry.name }}"></small>
                                    {% endif %}
                                </td>
                                <td class="text-end with-ppm">
                                    {% if grouped_solver|length > 1 %}
                                        <span class="badge bg-dark rounded-pill me-2">{{ 'puzzle_solved_times'|trans({'%count%': grouped_solver|length}) }}</span>
                                    {% endif %}
                                    {{ grouped_solver[0].time|puzzlingTime }}
                                    <br><small><span class="text-muted">P4</span> {{ ppm(grouped_solver[0].time, puzzle.piecesCount) }}</small>
                                </td>
                            </tr>
                        {% endfor %}
                        {% if solo_puzzle_solvers|length < 1 %}
                            <tr>
                                <td colspan="3" class="text-center">{{ 'be_first_to_solve'|trans }}</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-sm-12 col-md-6">
            <h2 class="h4">{{ 'ladder.groups'|trans }}</h2>

            <div class="table-responsive custom-table-wrapper mt-2 mb-5">
                <table class="table custom-table table-striped table-hover mb-0">
                    <thead>
                    <tr>
                        <th></th>
                        <th>{{ 'puzzler_name'|trans }}</th>
                        <th class="text-end">{{ 'time'|trans }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for puzzlers_group in group_puzzle_solvers %}
                        <tr>
                            <td>{{ loop.index }}.</td>
                            <td class="player-name text-nowrap">
                                {% for puzzle_solver in puzzlers_group.players %}
                                    {% if not loop.first %}
                                        <br>
                                    {% endif %}
                                    {% if puzzle_solver.playerId is not null %}
                                        <a class="player-name-item" href="{{ path('player_profile', {playerId: puzzle_solver.playerId}) }}">
                                            {% if logged_user.profile is not null and puzzle_solver.playerId in logged_user.profile.favoritePlayers %}
                                                <i class="ci-star-filled text-warning"></i>
                                            {% endif %}
                                            {{ puzzle_solver.playerName }}
                                        </a>
                                        {% if puzzle_solver.playerCountry is not null %}
                                            <small class="shadow-custom fi fi-{{ puzzle_solver.playerCountry.name }}"></small>
                                        {% endif %}
                                    {% else %}
                                        <span class="player-name-item">{{ puzzle_solver.playerName }}</span>
                                    {% endif %}
                                {% endfor %}
                            </td>
                            <td class="text-end with-ppm">
                                {{ puzzlers_group.time|puzzlingTime }}
                                <br><small><span class="text-muted">P4</span> {{ ppm(puzzlers_group.time, puzzle.piecesCount) }}</small>
                                <br><small><span class="text-muted">P6</span> {{ ppm(puzzlers_group.time, puzzle.piecesCount, puzzlers_group.players|length) }}</small>
                            </td>
                        </tr>
                    {% endfor %}
                    {% if group_puzzle_solvers|length < 1 %}
                        <tr>
                            <td colspan="4" class="text-center">{{ 'be_first_to_group_solve'|trans }}</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>



{% endblock %}
